<section class="p-4 text-sm">
  <p class="heading-1 mb-2">
    Deferrable Views
  </p>

  <div class="text-content">
    <p>
      <span class="text-zinc-50 tw-font-medium">Deferrable Views</span>
      in Angular 19 provide an enhanced built-in mechanism for lazy loading template fragments. Using the <code>&#64;defer</code> block, developers can optimize initial load times by deferring non-critical content, with improved integration with partial hydration, signals, and enhanced performance metrics.
    </p>

    <br>

    <div class="flex flex-col">
      <div class="flex border-b border-gray-200">
        <button  (click)="selectedTab = 1" [class.text-rose-300]="selectedTab===1" class="text-sky-400 hover:text-rose-400 font-semibold py-2 px-4 border-b-2 border-transparent hover:border-gray-500 focus:outline-none">
          Notes
        </button>
        <button  (click)="selectedTab = 2" [class.text-rose-300]="selectedTab===2" class="text-sky-400 hover:text-rose-400 font-semibold py-2 px-4 border-b-2 border-transparent hover:border-gray-500 focus:outline-none">
          Best Practices
        </button>
        <button  (click)="selectedTab = 3" [class.text-rose-300]="selectedTab===3" class="text-sky-400 hover:text-rose-400 font-semibold py-2 px-4 border-b-2 border-transparent hover:border-gray-500 focus:outline-none">
          Pros and Cons
        </button>
        <button  (click)="selectedTab = 4" [class.text-rose-300]="selectedTab===4" class="text-sky-400 hover:text-rose-400 font-semibold py-2 px-4 border-b-2 border-transparent hover:border-gray-500 focus:outline-none">
          Related Topics
        </button>
      </div>
      <div class="p-4">
        <ng-container [ngSwitch]="selectedTab">
          <div *ngSwitchCase="2">
            <ng-container *ngTemplateOutlet="bestRef;"></ng-container>
          </div>
          <div *ngSwitchCase="3">
            <ng-container *ngTemplateOutlet="prosConsRef;"></ng-container>
          </div>
          <div *ngSwitchCase="4">
            <ng-container *ngTemplateOutlet="topicsRef"></ng-container>
          </div>
          <div *ngSwitchDefault>
            <ng-container *ngTemplateOutlet="notesRef"></ng-container>
          </div>
        </ng-container>
      </div>
    </div>

  </div>
</section>

<ng-template #notesRef>
  <p>What are Deferrable Views?</p>
  <ul class="list-disc pl-4 text-sm">
    <li>
      <strong>Template Fragments</strong>:
      Portions of templates that can be lazily loaded based on conditions.
    </li>
    <li>
      <strong>&#64;defer Block</strong>:
      Angular's built-in syntax for declaring deferred content.
    </li>
    <li>
      <strong>Optimized Loading</strong>:
      Loads content only when needed, improving initial page load times.
    </li>
    <li>
      <strong>Fallback States</strong>:
      Provides loading, error, and placeholder states for a better user experience.
    </li>
  </ul>

  <br>
  <br>

  <p>Basic &#64;defer Syntax</p>
  <button (click)="code1.hidden = !code1.hidden" class="border border-rose-400 rounded-md px-1 text-sky-400">code</button>

  <span #code1 hidden copyToClipboard>
    <div class="flex flex-row justify-between items-center bg-gray-900 px-4 py-2 relative top-5">
      <span>html</span>
      <span class="copy-button-wrapper bg-gray-700"></span>
    </div>

    <pre>
      <code
        [highlight]="basicDeferCode"
        [languages]="['html']">
      </code>
    </pre>
  </span>

  <br>
  <br>

  <p>Trigger Conditions for Deferrable Content</p>
  <button (click)="code2.hidden = !code2.hidden" class="border border-rose-400 rounded-md px-1 text-sky-400">code</button>

  <span #code2 hidden copyToClipboard>
    <div class="flex flex-row justify-between items-center bg-gray-900 px-4 py-2 relative top-5">
      <span>html</span>
      <span class="copy-button-wrapper bg-gray-700"></span>
    </div>

    <pre>
      <code
        [highlight]="triggerConditionsCode"
        [languages]="['html']">
      </code>
    </pre>
  </span>

  <br>
  <br>

  <p>Prefetching Strategies</p>
  <button (click)="code3.hidden = !code3.hidden" class="border border-rose-400 rounded-md px-1 text-sky-400">code</button>

  <span #code3 hidden copyToClipboard>
    <div class="flex flex-row justify-between items-center bg-gray-900 px-4 py-2 relative top-5">
      <span>html</span>
      <span class="copy-button-wrapper bg-gray-700"></span>
    </div>

    <pre>
      <code
        [highlight]="prefetchingCode"
        [languages]="['html']">
      </code>
    </pre>
  </span>

  <br>
  <br>

  <p>New in Angular 19: Enhanced Deferrable Views</p>
  <button (click)="code4.hidden = !code4.hidden" class="border border-rose-400 rounded-md px-1 text-sky-400">code</button>

  <span #code4 hidden copyToClipboard>
    <div class="flex flex-row justify-between items-center bg-gray-900 px-4 py-2 relative top-5">
      <span>typescript</span>
      <span class="copy-button-wrapper bg-gray-700"></span>
    </div>

    <pre>
      <code
        [highlight]="v19EnhancementsCode"
        [languages]="['typescript']">
      </code>
    </pre>
  </span>

  <br>
  <br>

  <p>Key Enhancements in Angular 19</p>
  <ol class="list-decimal pl-4 text-sm">
    <li>
      <strong>Integrated Partial Hydration</strong>:
      <ul class="list-disc pl-4">
        <li>Deferrable views now work seamlessly with Angular's partial hydration system, allowing for finer control over which parts of server-rendered content get hydrated.</li>
        <li>Content can remain static or be selectively hydrated based on priority and user interaction patterns.</li>
      </ul>
    </li>
    <li>
      <strong>Performance Metrics Integration</strong>:
      <ul class="list-disc pl-4">
        <li>Built-in performance tracking for deferred content, with integration into Angular DevTools.</li>
        <li>Measures key metrics like Time to Interactive for deferred content.</li>
      </ul>
    </li>
    <li>
      <strong>Signals-based Trigger Conditions</strong>:
      <ul class="list-disc pl-4">
        <li>Deferred content can be triggered based on signals, providing reactive loading based on state changes.</li>
        <li>Enables more sophisticated loading strategies tied to application state.</li>
      </ul>
    </li>
    <li>
      <strong>Enhanced Loading States</strong>:
      <ul class="list-disc pl-4">
        <li>Minimum loading times to prevent "flashing" of loading states for fast connections.</li>
        <li>Ability to access parent scope data within loading and placeholder templates.</li>
      </ul>
    </li>
    <li>
      <strong>Priority Hints</strong>:
      <ul class="list-disc pl-4">
        <li>Support for browser priority hints to indicate the importance of deferred content to the browser's loading mechanisms.</li>
        <li>Helps optimize browser resource allocation for critical deferred content.</li>
      </ul>
    </li>
  </ol>

  <br>
  <br>

  <p>How Deferrable Views Improve Performance</p>
  <table class="w-full border-collapse rounded-lg overflow-hidden shadow-md">
    <thead>
      <tr class="bg-gray-800 text-gray-100">
        <th class="py-3 px-4 text-left">Metric</th>
        <th class="py-3 px-4 text-left">Improvement</th>
        <th class="py-3 px-4 text-left">Typical Impact</th>
      </tr>
    </thead>
    <tbody>
      <tr class="border-b border-gray-700 bg-gray-900 hover:bg-gray-800 transition-colors">
        <td class="py-3 px-4">Initial Load Time</td>
        <td class="py-3 px-4">Load only essential content initially</td>
        <td class="py-3 px-4">20-40% faster FCP</td>
      </tr>
      <tr class="border-b border-gray-700 bg-gray-950 hover:bg-gray-800 transition-colors">
        <td class="py-3 px-4">Bundle Size</td>
        <td class="py-3 px-4">Components loaded on demand</td>
        <td class="py-3 px-4">15-30% smaller initial bundle</td>
      </tr>
      <tr class="border-b border-gray-700 bg-gray-900 hover:bg-gray-800 transition-colors">
        <td class="py-3 px-4">Rendering Time</td>
        <td class="py-3 px-4">Less initial rendering work</td>
        <td class="py-3 px-4">Improved TTI by 25-35%</td>
      </tr>
      <tr class="bg-gray-950 hover:bg-gray-800 transition-colors">
        <td class="py-3 px-4">Resource Usage</td>
        <td class="py-3 px-4">Lower CPU/memory initial footprint</td>
        <td class="py-3 px-4">Reduced by up to 25%</td>
      </tr>
    </tbody>
  </table>
</ng-template>

<ng-template #bestRef>
  <ol class="list-decimal px-4 text-sm">
    <li>
      <strong class="text-sky-400">Choose Appropriate Trigger Conditions</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong>Viewport Triggers</strong>:
          Use <code>on viewport</code> for below-the-fold content that's likely to be scrolled to.
        </li>
        <li>
          <strong>Interaction Triggers</strong>:
          Use <code>on interaction</code> for content that should load after a user interaction, like clicking a tab.
        </li>
        <li>
          <strong>Idle Triggers</strong>:
          Use <code>on idle</code> for non-critical content that should load when the browser is idle.
        </li>
        <li>
          <strong>Condition Triggers</strong>:
          Use <code>when</code> with signals for content that depends on application state.
        </li>
      </ul>
    </li>
    <li>
      <strong class="text-sky-400">Optimize Prefetching Strategy</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong>Pair Rendering and Prefetching</strong>:
          Use different triggers for prefetching vs. rendering for best user experience.
        </li>
        <li>
          <strong>Prefetch Critical Paths</strong>:
          Prefetch content that users are likely to need based on common navigation patterns.
        </li>
        <li>
          <strong>Balance Resource Usage</strong>:
          Don't prefetch everythingâ€”prioritize based on likelihood of use and resource cost.
        </li>
      </ul>
    </li>
    <li>
      <strong class="text-sky-400">Design Meaningful Loading States</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong>Use Skeleton UI</strong>:
          Implement skeleton UI patterns in loading blocks that match the shape of the content.
        </li>
        <li>
          <strong>Avoid Layout Shifts</strong>:
          Ensure loading, placeholder, and content states have similar dimensions to prevent layout shifts.
        </li>
        <li>
          <strong>Set Minimum Display Times</strong>:
          Use the minimum time parameter to prevent loading state flashing on fast connections.
        </li>
      </ul>
    </li>
    <li>
      <strong class="text-sky-400">Implement Error Handling</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong>Always Include Error States</strong>:
          Always include an <code>&#64;error</code> block to handle loading failures gracefully.
        </li>
        <li>
          <strong>Provide Recovery Options</strong>:
          Include retry functionality in error states when appropriate.
        </li>
        <li>
          <strong>Log Errors</strong>:
          Implement error logging in error blocks to track loading issues.
        </li>
      </ul>
    </li>
    <li>
      <strong class="text-sky-400">Integration with Angular 19 Features</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong>Combine with Partial Hydration</strong>:
          Use deferrable views with partial hydration for optimal SSR performance.
        </li>
        <li>
          <strong>Use with Control Flow</strong>:
          Combine with <code>&#64;if</code>, <code>&#64;for</code>, and <code>&#64;switch</code> blocks for dynamic content control.
        </li>
        <li>
          <strong>Leverage Signals</strong>:
          Use signals for trigger conditions to create reactive loading patterns.
        </li>
      </ul>
    </li>
  </ol>
</ng-template>

<ng-template #prosConsRef>
  <strong class="text-sky-400">
    Pros:
  </strong>

  <br>

  <ol class="list-decimal px-10 text-sm">
    <li>
      <strong>Performance Improvements</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Faster Initial Load</span>:
          Only essential content is loaded initially, resulting in faster First Contentful Paint and Time to Interactive metrics.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Reduced Bundle Size</span>:
          Components are loaded on demand, reducing the initial JavaScript payload.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Optimized Resource Usage</span>:
          Lower CPU and memory usage during initial page load, especially important for mobile devices.
        </li>
      </ul>
    </li>
    <li>
      <strong>Enhanced User Experience</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Graceful Loading States</span>:
          Provides built-in loading, error, and placeholder states for a polished user experience.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Prioritized Content</span>:
          Critical content appears quickly, with less important content loaded later.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Responsive Interaction</span>:
          Interface remains responsive while heavy content loads in the background.
        </li>
      </ul>
    </li>
    <li>
      <strong>Developer Experience</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Declarative Syntax</span>:
          Simple, readable syntax that clearly expresses loading intent.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Built-in Framework Feature</span>:
          No need for third-party libraries or complex setup for lazy loading template fragments.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Fine-grained Control</span>:
          Multiple trigger options and prefetching strategies for precise loading control.
        </li>
      </ul>
    </li>
    <li>
      <strong>Angular 19 Enhancements</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Partial Hydration Integration</span>:
          Seamless integration with Angular's partial hydration system for superior SSR performance.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Signals Compatibility</span>:
          Can use signals for reactive loading conditions, enhancing the reactive programming model.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Performance Metrics</span>:
          Built-in performance tracking and integration with Angular DevTools for optimization.
        </li>
      </ul>
    </li>
  </ol>

  <br>
  <br>

  <strong class="text-sky-400">
    Cons:
  </strong>

  <br>

  <ol class="list-decimal px-10 text-sm">
    <li>
      <strong>Potential for Overuse</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Too Many Defer Blocks</span>:
          Overuse can lead to too many HTTP requests and actually harm performance.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Complex Loading Patterns</span>:
          Excessive defer blocks can create complex loading patterns that are hard to predict and debug.
        </li>
      </ul>
    </li>
    <li>
      <strong>UX Considerations</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Layout Shifts</span>:
          If not carefully designed, deferred content can cause layout shifts when it loads.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Loading Flashes</span>:
          Without minimum time settings, rapid loading/unloading of states can cause visual flashing.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">User Expectation Management</span>:
          Users may be confused by content that appears after they've already scanned a page.
        </li>
      </ul>
    </li>
    <li>
      <strong>Testing Challenges</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">Complex Test Scenarios</span>:
          Testing deferred content requires handling multiple loading states and timing conditions.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">E2E Test Timing</span>:
          End-to-end tests need to account for deferred loading timing, which can be tricky.
        </li>
      </ul>
    </li>
    <li>
      <strong>Learning Curve</strong>
      <ul class="list-disc pl-4">
        <li>
          <span class="text-zinc-50 tw-font-medium">New Syntax to Learn</span>:
          Additional syntax and concepts for team members to master.
        </li>
        <li>
          <span class="text-zinc-50 tw-font-medium">Strategic Implementation</span>:
          Requires understanding of performance optimization principles to use effectively.
        </li>
      </ul>
    </li>
  </ol>
</ng-template>

<ng-template #topicsRef>
  <ol class="list-decimal px-10 text-sm">
    <li>
      <strong>Built-in Control Flow</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          Angular's new template syntax for conditional rendering (<code>&#64;if</code>), iteration (<code>&#64;for</code>), and branching (<code>&#64;switch</code>).
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          Deferrable views (<code>&#64;defer</code>) are part of the same control flow syntax family and can be nested within other control flow blocks.
        </li>
      </ul>
    </li>
    <li>
      <strong>Lazy Loading</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          A technique where parts of an application are loaded only when needed, traditionally used for route-level code splitting.
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          Deferrable views bring lazy loading to the template fragment level, complementing route-level lazy loading.
        </li>
      </ul>
    </li>
    <li>
      <strong>Server-Side Rendering (SSR)</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          Rendering Angular applications on the server before sending them to the client.
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          Deferrable views can be integrated with SSR and partial hydration for more efficient server rendering.
        </li>
      </ul>
    </li>
    <li>
      <strong>Partial Hydration</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          A technique where only parts of a server-rendered application are "hydrated" with JavaScript functionality.
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          In Angular 19, deferrable views integrate with partial hydration to allow granular control over hydration.
        </li>
      </ul>
    </li>
    <li>
      <strong>Performance Optimization</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          Techniques to improve application load times, interactivity, and resource usage.
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          Deferrable views are a primary tool for optimizing initial load performance in Angular applications.
        </li>
      </ul>
    </li>
    <li>
      <strong>Signals</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          Angular's reactive state management primitives introduced in recent versions.
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          In Angular 19, deferrable views can use signals for their conditional triggers, enabling reactive loading patterns.
        </li>
      </ul>
    </li>
    <li>
      <strong>Core Web Vitals</strong>
      <ul class="list-disc pl-4">
        <li>
          <strong class="text-sky-400">Description</strong>:
          Google's metrics for measuring user experience quality, including LCP, FID, and CLS.
        </li>
        <li>
          <strong class="text-sky-400">Relation to Deferrable Views</strong>:
          Deferrable views can significantly improve metrics like Largest Contentful Paint by prioritizing critical content.
        </li>
      </ul>
    </li>
  </ol>
</ng-template>
